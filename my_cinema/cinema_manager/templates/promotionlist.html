{% extends 'base.html' %}
{% load static %}

{% block promotionList %}

<div id="promotion-list">
</div>
<div class="pagination">
    <button class="btn btn-primary prev-page" disabled>Trang trước</button>
    <button class="btn btn-primary next-page">Trang sau</button>
</div>



<script>
    const promotionList = document.getElementById('promotion-list');
    const prevPageBtn = document.querySelector('.prev-page');
    const nextPageBtn = document.querySelector('.next-page');
    let currentPage = 1;
    let totalPages;
    

    function renderPromotions(promotions) {
        promotionList.innerHTML = '';
        promotions.forEach(promotion => {
            const promotionItem = document.createElement('div');
            promotionItem.classList.add('col-md-3', 'mb-4');
            promotionItem.innerHTML = `
                <div class="card">
                    <img src="${promotion.image}" class="card-img-top" alt="${promotion.name}">
                    <div class="card-body">
                        <span class="card-title">${promotion.start_date}</span>
                        <span class="card-title">${promotion.end_date}</span>
                    </div>
                </div>
            `;
            promotionItem.addEventListener('click', () => {
                window.location.href = `/promotion/${promotion.id}/`;

            });
            
            promotionList.appendChild(promotionItem);
        });
    }


    function updatePaginationButtons() {
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = !totalPages || currentPage === totalPages;
    }

    
    function getPromotions( page = 1) {
        let url = `/api/promotions/?page=${page}`;
        
        fetch(url)
        .then(response => response.json())
        .then(data => {
            renderPromotions(data.results);
            totalPages = Math.ceil(data.count / data.results.length);
            currentPage = page;
            updatePaginationButtons();

            // Nếu không có next, ẩn nút next
            nextPageBtn.disabled = !data.next;
        })
        .catch(error => {
            console.error('Error fetching promotion data:', error);
        });
    }

    
    prevPageBtn.addEventListener('click', () => {
        getPromotions( currentPage - 1);
    });
    
    nextPageBtn.addEventListener('click', () => {
        getPromotions( currentPage + 1);
    });

    getPromotions();



    

</script>

{% endblock promotionList %}