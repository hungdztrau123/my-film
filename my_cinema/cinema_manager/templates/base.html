{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="{% static 'css/base.css' %}" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<style>
    .background-base {
        background:  url(../static/images/bg_pattern.png) #fff;
        width: 100%;
        height: 100%;
        color:#000;
        transition: background 0.3s, color 0.3s;
    }
    .button-toggle {
        padding: 10px 20px;
        font-size: 16px;
        color: #fff;
        background-color: #000;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
    }
</style>
<body>
  <div id="base" class="background-base">
    con de 
    <button id="toggle-button" class="button-toggle">Dark</button>
   
  
  <div id="session-info"></div>

  <span id="logout-btn" class="btn btn-danger" style="width: 100px; display: none;">Đăng Xuất</span>
  <span id="login-btn" class="btn btn-danger" style="width: 100px; display: none;">Đăng Nhập</span>


  {% block logIn %} 
  {% endblock logIn %}

  {% block register %}
  {% endblock register %}


  {% block sliderHome %} 
  {% endblock sliderHome %}

  {% block contentHome %} 
  {% endblock contentHome %}

  {% block topFilm %}
  {% endblock topFilm %}

  {% block promotionHome %}
  {% endblock promotionHome %}


  {% block slider %} 
  {% endblock slider %}

  {% block content %} 
  {% endblock content %}
  
  {% block filmDetail %}
  {% endblock filmDetail %}

  {% block bookFilm %}
  {% endblock bookFilm %}

  {% block promotionList %}
  {% endblock promotionList %}

  {% block promotionDetail %}
  {% endblock promotionDetail %}

  {% block area %} 
  {% endblock area %}

  {% block roomDetail %}
  {% endblock roomDetail %}
  
  {% block contact %} 
  {% endblock contact %} 

  {% block booking %} 
  {% endblock booking %} 

  

  <div>
    <div class="col" id="promotion-banner">
    <!-- Nội dung các phim sẽ được tạo động bằng JavaScript -->
    </div>
  </div>

  </div>


  <script>
        const toggleButton = document.getElementById('toggle-button');
        const baseDiv = document.getElementById('base');

        let isDarkMode = localStorage.getItem('isDarkMode') === 'true' || false;

        // Hàm để cập nhật giao diện
        function updateTheme() {
            if (isDarkMode) {
                toggleButton.textContent = 'Light';
                toggleButton.style.color = '#000';
                toggleButton.style.backgroundColor = '#fff';
                baseDiv.style.background = 'url(../static/images/bg_pattern.png) #000';
                baseDiv.style.color = '#fff';
            } else {
                toggleButton.textContent = 'Dark';
                toggleButton.style.color = '#fff';
                toggleButton.style.backgroundColor = '#000';
                baseDiv.style.background = 'url(../static/images/bg_pattern.png) #fff';
                baseDiv.style.color = '#000';
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            updateTheme();
        });

        toggleButton.addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            localStorage.setItem('isDarkMode', isDarkMode);
            updateTheme();
        });

  </script>

  <script>

    const sessionName = localStorage.getItem('session_name');
    // Kiểm tra access token khi tải trang
    const accessToken = localStorage.getItem('access_token');

    if (accessToken) {
        document.getElementById('session-info').innerText = `Xin chao : ${sessionName}`;
        // Nếu có access token, hiển thị nút Logout và ẩn nút Login
        document.getElementById('logout-btn').style.display = 'block';
    } else {
        // Nếu không có access token, hiển thị nút Login
        document.getElementById('login-btn').style.display = 'block';
    }

    document.getElementById('login-btn').addEventListener('click', function() {
        window.location.href = '/login/';
    });

    document.getElementById('logout-btn').addEventListener('click', function() {
        
        const accessToken = localStorage.getItem('access_token');
        const refreshToken = localStorage.getItem('refresh_token');

        if (refreshToken) {
            fetch('/api/logout/', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ refresh: refreshToken }),
            })
            .then(response => {
                if (response.ok) {
                    localStorage.removeItem('access_token');  // Xóa access token
                    localStorage.removeItem('refresh_token'); // Xóa refresh token
                    localStorage.removeItem('session_name');
                    localStorage.removeItem('is_admin');

                    window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
                
                } else if (response.status === 401) {
                    alert('Token đã hết hạn. Vui lòng đăng nhập lại.');
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token'); 
                    localStorage.removeItem('session_name');
                    localStorage.removeItem('is_admin');

                    window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
                
                } else {
                    alert('Logout failed! Please try again.');
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token'); 
                    localStorage.removeItem('session_name');
                    localStorage.removeItem('is_admin');

                    window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
                }
            })
            .catch(error => {
                console.error('Error during logout:', error);
                alert('Logout failed! Please try again later.');
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token'); 
                localStorage.removeItem('session_name');
                localStorage.removeItem('is_admin');

                window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
            });
        } else {
            alert('You are not logged in.');
            window.location.href = '/login/';
        }
    });
  </script>

  <script>
      // Lấy danh sách promotions từ API
      fetch('/api/promotions/')
      .then(response => response.json())
      .then(data => {
          const promotionList = document.getElementById('promotion-banner');
      
          // Tạo các phần tử promotion
          data.results.slice(0, 2).forEach(promotion => {
              const promotionItem = document.createElement('div');
              promotionItem.classList.add('item-promotion');
              promotionItem.innerHTML = `
                  <div class="card">
                      <img src="${promotion.image}" class="card-img-top" style="height:300px;" alt="${promotion.name}">
                  </div>
              `;
              promotionItem.addEventListener('click', () => {
                  window.location.href = `/promotion/${promotion.id}/`;
              });
              promotionList.appendChild(promotionItem);
          });
      })
      .catch(error => {
          console.error('Error fetching promotion data:', error);
      });

  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>