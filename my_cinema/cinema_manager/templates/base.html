{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="{% static 'css/base.css' %}" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<style>
    .background-base {
        width: 100%;
        height: 100%;
        transition: background 0.3s linear;
    }
    .button-toggle {
        max-width: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        background-color: #000;
        border: none;
        cursor: pointer;
        padding: 0px 5px;
        border-radius: 5px;
        
        transition: background-color 0.3s, color 0.3s;
    }

    .header-base{
        display: flex;
        flex-direction: column;
        align-items: center;  
    }
    .header-base-top{
        display: flex;
        width: 100%;
        align-items: center;
        justify-content: end;
        padding: 3px 10px;
        background-color: #efebdb;

    }
    
    .btn-logout{
        font-size: 12px;
        max-width: 73px;
        padding:5px;
        cursor: pointer;

    }
    .btn-login{
        font-size: 12px;
        max-width: 73px;
        padding:5px;
        cursor: pointer;
    }
    .header-base-bottom{
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        border-bottom: 3px solid #cdc197;
      
    }
    .header-box-logo{
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;

    }
    .logo-item{
        width: 21%; 
        height: 100px;
        margin-top: 25px;
        cursor: pointer;

    }
    .logo-img{
        width: 100%;
        height: 100%;
    }
    .header-box-info{
        width: 100%;
        font-size: 13px;
        display: flex;
        align-items: center;
        justify-content: end;
        padding-right: 2%;

    }

    .box-session-info{
        position: relative;
        display: flex;
        flex-direction: column;
        cursor: pointer;
        
    }
    
    .box-content-user{
        position: absolute;
        display: flex;
        align-items: center;
        top: -77px;
        left: 3px;
        display: none;


    }
    .box-content-useritem{
        width: 100%;
        padding: 0px;
        margin: 0px;
        list-style: none;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .content-user-item-info{
        display: flex;
        min-width: 142px;
        align-items: center;
        justify-content: center;
        padding: 5px 0px; 
        border: 2px solid #d5a12c;
        box-shadow: 0px 0px 0px 3px #cdc197;
        margin-bottom: 7px;
        cursor: pointer;
        font-weight: bold;
        background-color:#cdc197;
        text-transform: uppercase;
        

    }
    .content-user-item-ticket{
        display: flex;
        min-width: 142px;
        align-items: center;
        justify-content: center;
        padding: 5px 0px; 
        border: 2px solid #d5a12c;
        box-shadow: 0px 0px 0px 3px #cdc197;
        font-weight: bold;
        background-color:#cdc197;
        text-transform: uppercase;
        cursor: pointer;
    }

    .header-content-info{
        padding: 5px 15px;
        background-color: #cdc197;
    }

    

    .container-base{
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
     
    }
    .header-box-navbar{
        display: flex;
        width: 100%;
        align-items: center;
        justify-content: center;
        padding: 10px;
        border-bottom: 1px solid #cdc197;
        position: sticky;
        position: -webkit-sticky;
        top: 0px;
        left: 0px;
        z-index: 100000000;
        background-color: rgba(0,0,0,0.05);
        box-shadow: 0px 3px 3px 0px #d5a12c;
       
        
    }
    .box-navbar{
        list-style: none;
        padding: 0px;
        margin: 0px;
        display: flex;
        align-items: center;
    }
    .content-navbar{
        font-size: 16px;
        border-left: 1px solid #ccc;
        cursor: pointer;
        padding: 0px 15px;
        letter-spacing: 1px;
        font-weight: bold;
    }


    .container-box{
        width: 100%;
        display: flex;
        flex-direction: column;
        

    }

    .box-promotion{
        width: 100%;
        padding: 30px 0px;
        border-bottom: 1px solid #cdc197;
        box-shadow: 0px 0px 3px 2px #d5a12c;

    }
    .list-promotion{
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;

    }
    .promotion-item{
        width: 65%;
        margin: 10px 0px;
        
    }

    .promotion-item:hover{
        box-shadow: 0px 0px 3px 2px #d5a12c;
        cursor: pointer;
    }

    .box-promotion-img{
        width: 100%;
    }
    .promotion-img{
        width: 100%;
    }

    .footer-base{
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 30px 0px;
        box-shadow: 0px 0px 3px 2px #d5a12c;
        font-size: 13px;
    }
    .box-footer-base{
        width: 70%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;

    }

    .footer-box-logo{
        cursor: pointer;
        width: 20%;
        margin-bottom: 20px;

    }
    .footer-logo-item{
        width: 100%;


    }
    .footer-logo-img{
        width: 100%;

    }
    .img-logo-footer{
        
    }
    .text-footer{

    }


    .box-pagination{
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;

    }
    .prev-page{
        padding: 5px 10px; 
        border: 2px solid #d5a12c;
        box-shadow: 0px 0px 0px 3px #cdc197;
        margin: 7px ;
        color: #d5a12c;
        text-shadow: 1px 1px 1px #000;
        border-top-left-radius: 7px;
        border-bottom-left-radius: 7px;
        cursor: pointer;

    }
    .next-page{
        padding: 5px 10px; 
        border: 2px solid #d5a12c;
        box-shadow: 0px 0px 0px 3px #cdc197;
        margin: 7px ;
        color: #d5a12c;
        text-shadow: 1px 1px 1px #000;
        border-top-right-radius: 7px;
        border-bottom-right-radius: 7px;
        cursor: pointer;

    }







</style>
<body>
  <div id="base" class="background-base">
    <div class="header-base" id="header-base">
        
        <div class="header-base-top">
            <span id="toggle-button" class="button-toggle">Dark</span>
            <span id="logout-btn" class="btn-logout" style="display: none;">Đăng Xuất</span>
            <span id="login-btn" class="btn-login" style="display: none;">Đăng Nhập</span>
        </div>

        <div class="header-base-bottom">

            <div class="header-box-logo" id="logo-cinema">
                
            </div>

            <div class="header-box-info">
                <div class="box-session-info" id="box-session-info">
                    <div class="box-content-user" id="box-content-user">
                        <ul class="box-content-useritem">
                            <li class="content-user-item-info" id="content-user-item-info">Thông tin của tôi</li>
                            <li class="content-user-item-ticket" id="content-user-item-ticket">Vé của tôi</li>
                        </ul>
                    </div>
                    <div id="session-info" class="header-content-info"></div>
                    <div id="session-id-user" class="header-content-id-user"></div>
                    

                </div>
            </div>
            
        </div>
    </div>

    <div class="container-base">
        <div class="header-box-navbar" id="header-box-navbar">
            <ul class="box-navbar">
                <li id="navbar-film" class="content-navbar" style="border-left: 0px ;">PHIM</li>
                <li id="navbar-area" class="content-navbar">RẠP CHIẾU PHIM</li>
                <li id="navbar-promotion" class="content-navbar">KHUYẾN MÃI</li>
                <li id="navbar-contact" class="content-navbar">LIÊN HỆ</li>
            </ul>
        </div>
        
        <div class="container-box">
    
            {% block logIn %} 
            {% endblock logIn %}

            {% block register %}
            {% endblock register %}


            {% block sliderHome %} 
            {% endblock sliderHome %}

            {% block contentHome %} 
            {% endblock contentHome %}

            {% block topFilm %}
            {% endblock topFilm %}

            {% block promotionHome %}
            {% endblock promotionHome %}


            {% block slider %} 
            {% endblock slider %}

            {% block content %} 
            {% endblock content %}
            
            {% block filmDetail %}
            {% endblock filmDetail %}

            {% block bookFilm %}
            {% endblock bookFilm %}

            {% block bookCombo %} 
            {% endblock bookCombo %} 

            {% block promotionList %}
            {% endblock promotionList %}

            {% block promotionDetail %}
            {% endblock promotionDetail %}

            {% block area %} 
            {% endblock area %}

            {% block roomDetail %}
            {% endblock roomDetail %}
            
            {% block contact %} 
            {% endblock contact %} 

            {% block booking %} 
            {% endblock booking %} 

            {% block bill %}
            {% endblock bill %} 

            {% block listTicket %} 
            {% endblock listTicket %} 



            <div class="box-promotion">
                <div class="list-promotion" id="promotion-banner">
                <!-- Nội dung các phim sẽ được tạo động bằng JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div class="footer-base">
        <div class="box-footer-base">
            
            <div class="footer-box-logo" id="footer-logo-cinema"></div>
            
            <span class="text-footer">CÔNG TY TNHH CINEPLEX ODEON VIỆT NAM</span>
            <span class="text-footer">Địa chỉ: Tầng 3, Hà Nội, Việt Nam</span>
            <span class="text-footer">Hotline: (028) 3775 2524</span>
            <span class="text-footer">COPYRIGHT © CINEPLEXODEONVN.COM - ALL RIGHTS RESERVED.</span>
        </div>
    </div>
        

  

  </div>


  <script>
        const toggleButton = document.getElementById('toggle-button');
        const baseDiv = document.getElementById('base');
        const headerBaseDiv = document.getElementById('header-base');
        const headerBoxNavbarDiv = document.getElementById('header-box-navbar');



        let isDarkMode = localStorage.getItem('isDarkMode') === 'true' || false;

        // Hàm để cập nhật giao diện
        function updateTheme() {
            if (isDarkMode) {
                toggleButton.textContent = 'Light';
                toggleButton.style.color = '#d5a12c';
                toggleButton.style.textShadow = '1px 1px 1px #000';
                toggleButton.style.backgroundColor = '#fff';

                baseDiv.style.color = '#d5a12c';
                baseDiv.style.textShadow = '1px 1px 1px #fff';
                headerBaseDiv.style.textShadow = '1px 1px 1px #000';


            } else {
                toggleButton.textContent = 'Dark';
                toggleButton.style.color = '#d5a12c';
                toggleButton.style.textShadow = '1px 1px 1px #fff';
                toggleButton.style.backgroundColor = '#000';

                baseDiv.style.color = '#d5a12c';
                baseDiv.style.textShadow = '1px 1px 1px #000';

            }

            // Cập nhật hình nền dựa trên chế độ
            fetch('/api/backgrounds/')
                .then(response => response.json())
                .then(data => {
                    if (data.results.length > 0) {
                        const imageUrl = data.results[0].image; // Lấy image từ phần tử đầu tiên
                        baseDiv.style.background = `url(${imageUrl}) ${isDarkMode ? '#000' : '#fff'}`;
                        
                    }
            })
            .catch(error => {
                console.error('Error fetching background data:', error);
            });


        }

        window.addEventListener('DOMContentLoaded', () => {
            updateTheme();
        });

        toggleButton.addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            localStorage.setItem('isDarkMode', isDarkMode);
            updateTheme();
        });

  </script>

  <script>

    const sessionName = localStorage.getItem('session_name');
    const sessionId = localStorage.getItem('session_id');

    // Kiểm tra access token khi tải trang
    const accessToken = localStorage.getItem('access_token');

    if (accessToken) {
        document.getElementById('session-info').innerText = `Xin chao : ${sessionName}`;
        document.getElementById('session-id-user').innerText = `${sessionId}`;

        // Nếu có access token, hiển thị nút Logout và ẩn nút Login
        document.getElementById('logout-btn').style.display = 'flex';
    } else {
        // Nếu không có access token, hiển thị nút Login
        document.getElementById('login-btn').style.display = 'flex';
    }

    const boxSessionInfo = document.getElementById('box-session-info');
    const boxContentUser = document.getElementById('box-content-user');

   
    boxSessionInfo.addEventListener('click', function(event) {
        if (boxContentUser.style.display === 'flex') {
            boxContentUser.style.display = 'none';
        } else {
            boxContentUser.style.display = 'flex';
        }
        event.stopPropagation(); 
    });

    document.addEventListener('click', function() {
        boxContentUser.style.display = 'none';
    });

    document.getElementById('content-user-item-ticket').addEventListener('click', function() {
        window.location.href = `/listticket/${sessionId}/`;
    });

    document.getElementById('navbar-film').addEventListener('click', function() {
        window.location.href = '/homepage/';
    });
    document.getElementById('navbar-area').addEventListener('click', function() {
        window.location.href = '/area/';
    });
    document.getElementById('navbar-promotion').addEventListener('click', function() {
        window.location.href = '/promotionlist/';
    });
    document.getElementById('navbar-contact').addEventListener('click', function() {
        window.location.href = '/contact/';
    });

    document.getElementById('login-btn').addEventListener('click', function() {
        window.location.href = '/login/';
    });

    document.getElementById('logout-btn').addEventListener('click', function() {
        
        const accessToken = localStorage.getItem('access_token');
        const refreshToken = localStorage.getItem('refresh_token');

        if (refreshToken) {
            fetch('/api/logout/', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ refresh: refreshToken }),
            })
            .then(response => {
                if (response.ok) {
                    localStorage.removeItem('access_token');  // Xóa access token
                    localStorage.removeItem('refresh_token'); // Xóa refresh token
                    localStorage.removeItem('session_name');
                    localStorage.removeItem('is_admin');

                    window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
                
                } else if (response.status === 401) {
                    alert('Token đã hết hạn. Vui lòng đăng nhập lại.');
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token'); 
                    localStorage.removeItem('session_name');
                    localStorage.removeItem('is_admin');

                    window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
                
                } else {
                    alert('Logout failed! Please try again.');
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token'); 
                    localStorage.removeItem('session_name');
                    localStorage.removeItem('is_admin');

                    window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
                }
            })
            .catch(error => {
                console.error('Error during logout:', error);
                alert('Logout failed! Please try again later.');
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token'); 
                localStorage.removeItem('session_name');
                localStorage.removeItem('is_admin');

                window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
            });
        } else {
            alert('You are not logged in.');
            window.location.href = '/login/';
        }
    });
  </script>

  <script>
      // Lấy danh sách promotions từ API
      fetch('/api/promotions/')
      .then(response => response.json())
      .then(data => {
          const promotionList = document.getElementById('promotion-banner');
      
          // Tạo các phần tử promotion
          data.results.slice(0, 2).forEach(promotion => {
              const promotionItem = document.createElement('div');
              promotionItem.classList.add('promotion-item');
              promotionItem.innerHTML = `
                  <div class="box-promotion-img">
                      <img src="${promotion.banner}" class="promotion-img" alt="${promotion.name}">
                  </div>
              `;
              promotionItem.addEventListener('click', () => {
                  window.location.href = `/promotion/${promotion.id}/`;
              });
              promotionList.appendChild(promotionItem);
          });
      })
      .catch(error => {
          console.error('Error fetching promotion data:', error);
      });

  </script>



  <script>
        
        fetch('/api/logos/')
        .then(response => response.json())
        .then(data => {
            const logoList = document.getElementById('logo-cinema');
        
            // Tạo các phần tử logo
            data.results.slice(0, 1).forEach(logo => {
                const logoItem = document.createElement('div');
                logoItem.classList.add('logo-item');
                logoItem.innerHTML = `
                        <img src="${logo.image}" class="logo-img" alt="${logo.name}">
                `;
                logoItem.addEventListener('click', () => {
                    window.location.href = `/home/`;
                });
                logoList.appendChild(logoItem);
            });


            const logoFooterList = document.getElementById('footer-logo-cinema');
        
            // Tạo các phần tử logo
            data.results.slice(0, 1).forEach(logoFooter => {
                const logoFooterItem = document.createElement('div');
                logoFooterItem.classList.add('footer-logo-item');
                logoFooterItem.innerHTML = `
                        <img src="${logoFooter.image}" class="footer-logo-img" alt="${logoFooter.name}">
                `;
                logoFooterItem.addEventListener('click', () => {
                    window.location.href = `/home/`;
                });
                logoFooterList.appendChild(logoFooterItem);
            });

        })
        .catch(error => {
            console.error('Error fetching logo data:', error);
        });

  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>