{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<style>
    .background-base {
        background:  url(../static/images/bg_pattern.png) #fff;
        width: 100%;
        height: 100%;
        color:#000;
        transition: background 0.3s, color 0.3s;
    }
    .button-toggle {
        padding: 10px 20px;
        font-size: 16px;
        color: #fff;
        background-color: #000;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
    }
</style>
<body>
  <div id="base" class="background-base">
    con de 
    <button id="toggle-button" class="button-toggle">Dark</button>
   
  
    <div id="session-info"></div>

    <span id="logout-btn" class="btn btn-danger" style="width: 100px; display: none;">Đăng Xuất</span>
    
    {% block comboManage %} 
    {% endblock comboManage %} 

    {% block comboInsert %} 
    {% endblock comboInsert %} 

    {% block comboUpdate %} 
    {% endblock comboUpdate %} 


    {% block filmManage %} 
    {% endblock filmManage %} 

    {% block filmInsert %} 
    {% endblock filmInsert %} 

    {% block filmUpdate %} 
    {% endblock filmUpdate %} 


    {% block scheduleManage %} 
    {% endblock scheduleManage %} 

    {% block scheduleInsert %} 
    {% endblock scheduleInsert %} 
    
    {% block scheduleUpdate %} 
    {% endblock scheduleUpdate %} 


    {% block areaManage %} 
    {% endblock areaManage %} 
    
    {% block areaInsert %} 
    {% endblock areaInsert %} 

    {% block areaUpdate %} 
    {% endblock areaUpdate %} 


    {% block placeManage %} 
    {% endblock placeManage %} 

    {% block placeInsert %} 
    {% endblock placeInsert %} 

    {% block placeUpdate %} 
    {% endblock placeUpdate %} 


    {% block dayShowManage %} 
    {% endblock dayShowManage %} 

    {% block dayShowInsert %} 
    {% endblock dayShowInsert %} 

    {% block dayShowUpdate %} 
    {% endblock dayShowUpdate %} 


    {% block roomManage %} 
    {% endblock roomManage %} 

    {% block roomInsert %} 
    {% endblock roomInsert %} 

    {% block roomUpdate %} 
    {% endblock roomUpdate %} 


    {% block seatManage %} 
    {% endblock seatManage %} 

    {% block seatInsert %} 
    {% endblock seatInsert %} 

    {% block seatUpdate %} 
    {% endblock seatUpdate %}
    

    {% block imageManage %} 
    {% endblock imageManage %} 

    {% block imageInsert %} 
    {% endblock imageInsert %} 

    {% block imageUpdate %} 
    {% endblock imageUpdate %}

    
    {% block videoManage %} 
    {% endblock videoManage %} 

    {% block videoInsert %} 
    {% endblock videoInsert %} 

    {% block videoUpdate %} 
    {% endblock videoUpdate %}
    







  </div>


  <script>
        const toggleButton = document.getElementById('toggle-button');
        const baseDiv = document.getElementById('base');

        let isDarkMode = localStorage.getItem('isDarkMode') === 'true' || false;

        // Hàm để cập nhật giao diện
        function updateTheme() {
            if (isDarkMode) {
                toggleButton.textContent = 'Light';
                toggleButton.style.color = '#000';
                toggleButton.style.backgroundColor = '#fff';
                baseDiv.style.background = 'url(../static/images/bg_pattern.png) #000';
                baseDiv.style.color = '#fff';
            } else {
                toggleButton.textContent = 'Dark';
                toggleButton.style.color = '#fff';
                toggleButton.style.backgroundColor = '#000';
                baseDiv.style.background = 'url(../static/images/bg_pattern.png) #fff';
                baseDiv.style.color = '#000';
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            updateTheme();
        });

        toggleButton.addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            localStorage.setItem('isDarkMode', isDarkMode);
            updateTheme();
        });

  </script>

  <script>

    const sessionName = localStorage.getItem('session_name');
    // Kiểm tra access token khi tải trang
    const accessToken = localStorage.getItem('access_token');
    const isAdmin = localStorage.getItem('is_admin');

    if (accessToken && isAdmin === 'true') {
        document.getElementById('session-info').innerText = `Xin chao : ${sessionName}`;
        // Nếu có access token, hiển thị nút Logout và ẩn nút Login
        document.getElementById('logout-btn').style.display = 'block';
    } else {
        window.location.href = '/login/';
    }

    document.getElementById('logout-btn').addEventListener('click', function() {
        
        const accessToken = localStorage.getItem('access_token');
        const refreshToken = localStorage.getItem('refresh_token');
        const isAdmin = localStorage.getItem('is_admin');


        if (refreshToken) {
            fetch('/api/logout/', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ refresh: refreshToken }),
            })
            .then(response => {
                if (response.ok) {
                    localStorage.removeItem('access_token');  // Xóa access token
                    localStorage.removeItem('refresh_token'); // Xóa refresh token
                    localStorage.removeItem('session_name');
                    localStorage.removeItem('is_admin');

                    window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
                
                } else if (response.status === 401) {
                    alert('Token đã hết hạn. Vui lòng đăng nhập lại.');
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token'); 
                    localStorage.removeItem('session_name');
                    localStorage.removeItem('is_admin');
                    window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
                
                } else {
                    alert('Logout failed! Please try again.');
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token'); 
                    localStorage.removeItem('session_name');
                    localStorage.removeItem('is_admin');
                    window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
                }
            })
            .catch(error => {
                console.error('Error during logout:', error);
                alert('Logout failed! Please try again later.');
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token'); 
                localStorage.removeItem('session_name');
                localStorage.removeItem('is_admin');
                window.location.href = '/login/'; // Chuyển hướng về trang đăng nhập
            });
        } else {
            alert('You are not logged in.');
            window.location.href = '/login/';
        }
    });
  </script>

  


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>